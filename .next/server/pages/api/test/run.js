"use strict";(()=>{var e={};e.id=710,e.ids=[710],e.modules={4470:e=>{e.exports=require("fs-extra")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2790:(e,t,r)=>{r.r(t),r.d(t,{config:()=>g,default:()=>f,routeModule:()=>m});var s={};r.r(s),r.d(s,{default:()=>p});var o=r(1802),n=r(7153),i=r(6249);let a=require("child_process");var l=r(5315),d=r.n(l),c=r(4470),u=r.n(c);async function p(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{testType:r,config:s,options:o={}}=e.body;if(!r)return t.status(400).json({message:"Test type is required"});let n=d().join(process.cwd(),"config","default.json");if(s){let e=d().join(process.cwd(),"config",`temp-${Date.now()}.json`);await u().writeJson(e,s,{spaces:2}),n=e}let i=[d().join(process.cwd(),"src","core","TestRunner.js"),`--config=${n}`,`--type=${r}`];o.html&&i.push("--html"),o.verbose&&i.push("--verbose"),void 0!==o.headless&&i.push(o.headless?"--headless":"--show-browser"),t.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Cache-Control"}),t.write(`data: ${JSON.stringify({type:"start",message:"Starting test execution..."})}

`);let l=(0,a.spawn)("node",i,{cwd:process.cwd(),stdio:["ignore","pipe","pipe"]}),c="",p=!1;l.stdout.on("data",e=>{let r=e.toString();c+=r,t.write(`data: ${JSON.stringify({type:"stdout",message:r.trim()})}

`)}),l.stderr.on("data",e=>{let r=e.toString();c+=r,p=!0,t.write(`data: ${JSON.stringify({type:"stderr",message:r.trim()})}

`)}),l.on("close",async e=>{try{s&&n.includes("temp-")&&await u().remove(n);let r=d().join(process.cwd(),"reports"),o=(await u().readdir(r)).filter(e=>e.startsWith("test-report-")&&e.endsWith(".json")).sort().reverse(),i=null;if(o.length>0){let e=d().join(r,o[0]);i=await u().readJson(e)}t.write(`data: ${JSON.stringify({type:"complete",code:e,success:0===e&&!p,report:i,message:0===e?"Test execution completed successfully":"Test execution completed with errors"})}

`)}catch(e){t.write(`data: ${JSON.stringify({type:"error",message:`Error processing results: ${e.message}`})}

`)}finally{t.end()}}),l.on("error",e=>{t.write(`data: ${JSON.stringify({type:"error",message:`Failed to start test process: ${e.message}`})}

`),t.end()}),e.on("close",()=>{l&&!l.killed&&l.kill("SIGTERM")})}catch(e){console.error("Test execution API error:",e),t.status(500).json({message:"Failed to execute tests",error:e.message})}}let f=(0,i.l)(s,"default"),g=(0,i.l)(s,"config"),m=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/test/run",pathname:"/api/test/run",bundlePath:"",filename:""},userland:s})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2790);module.exports=r})();